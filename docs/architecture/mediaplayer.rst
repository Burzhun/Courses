Медиаплеер
===========

Медиаплеер для воспроизведения видео

Функционал
----------

* Просмотр видео и аудио в разном разрешении
* Автоматический выбор качества видео в зависимости от скорости сети
* Конвертация видео при загрузке на сервер в `MPEG-DASH`_ формате для возмоности быстрой перемотки и оптимизации работы сервера

Клиентская часть
~~~~~~~~~~~~~~~~~~

Клиент медиаплеера написан с использованием
библиотеки https://github.com/clappr/clappr.

В качестве движка для медиаплеера
использован https://github.com/google/shaka-player/

Клиент представляет собой обычный плеер,
с возможностью перемотки, выбора качества видео
и полноэкранного режима. Для запуска плеера ему необходим
mpd файл манифеста, который является частью спецификации MPEG-DASH,
в котором описаны доступные потоки для воспроизведения (для разрешений
480, 720, аудиопоток и т.п.). Mpd файл генерируется сервером при загрузке видео.

Так же клиенту можно указать превью изображение,
которой оно будет отображать до воспроизведения видео.

Подробнее про использование в коде см в ветке developer

Серверная часть
~~~~~~~~~~~~~~~

Для использования формата `MPEG-DASH`_ есть
специальное поле VideoField, который по интерфейсу является приемником
FileField. Основное отличие в том, что при загрузке файла, он проверяется
на соответсвию видеоформатам, а так же запускается конвертация видео
в `MPEG-DASH`_ . Конвертация может происходить как синхронно, так и
запускаться как Celery задача, если в settings конфиг будет установлен
DASH_RUN_CONVERTATION_AT_ASYNC=True.

При конвертации будут созданы следующий файлы:

* Файл манифеста mpd DASH, в котором описаны какие потоки доступны.
* Файл инициализации потоков. Потоки это по сути разные разрешения (480, 720 и т.п.) и один аудиопоток. В каждом из этих файлов подробно описана информация о своём потоке  и о чанках (сегментах) принадлежащих этому потоку с привязкой ко вермени.
* Файлы сегментов (чанки) непосредсвенно куски, из которых состоит поток. На момент написания чанк хранил информацию примерно о 3-4 секундах потока.
* Превью-изображение для плеера. Первый кадр на первой секунде видео.


Как всё работает
~~~~~~~~~~~~~~~~

При воспроизведении или при перемотке видео на определенную секунду,
в mpd файле ищется установленный на данный момент поток, в потоке ищется чанк,
на который приходится текущая секунда, и начиная с этого чанка загружается
вся последовательность чанков.

.. _`MPEG-DASH`: https://ru.wikipedia.org/wiki/MPEG-DASH
